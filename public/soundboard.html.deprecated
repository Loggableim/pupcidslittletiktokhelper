<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TikTok LIVE Soundboard</title>
  <link rel="stylesheet" href="/css/tailwind.output.css" />
  <script src="/socket.io/socket.io.js"></script>
  <style>
    /* Apple-inspired Design */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    .dot { width: 12px; height: 12px; border-radius: 9999px; }
    .scroll-shadow { box-shadow: inset 0 -12px 12px -12px rgba(0,0,0,0.15); }
    .tab-btn { transition: all 0.2s; }
    .tab-btn[aria-selected="true"]{ background:#0ea5e9; color: white; }
    .gift-row:hover { background: rgba(148,163,184,.08); }
    .gift-row.assigned { background: rgba(14, 165, 233, 0.1); border-color: rgba(14, 165, 233, 0.3); }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Light Mode */
    .light-mode {
      background: #f5f5f7;
      color: #1d1d1f;
    }
    .light-mode .bg-slate-950 { background: #ffffff !important; }
    .light-mode .bg-slate-900 { background: #f5f5f7 !important; }
    .light-mode .bg-slate-800 { background: #e8e8ed !important; }
    .light-mode .bg-slate-700 { background: #d2d2d7 !important; }
    .light-mode .text-slate-100 { color: #1d1d1f !important; }
    .light-mode .text-slate-300 { color: #6e6e73 !important; }
    .light-mode .text-slate-400 { color: #86868b !important; }
    .light-mode .border-slate-800 { border-color: #d2d2d7 !important; }
    .light-mode .border-slate-700 { border-color: #d2d2d7 !important; }

    /* Toast Notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #1f2937;
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      z-index: 9999;
      animation: slideInRight 0.3s ease-out;
    }
    .light-mode .toast {
      background: #ffffff;
      color: #1d1d1f;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    @keyframes slideInRight {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body class="bg-slate-950 text-slate-100">
  <div class="max-w-7xl mx-auto p-4 md:p-8">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl md:text-3xl font-semibold">üéµ TikTok LIVE Soundboard</h1>
      <div class="flex items-center gap-3">
        <div id="statusDot" class="dot bg-red-500"></div>
        <span id="statusText" class="text-sm text-slate-300">offline</span>
        <button id="themeToggle" class="rounded-lg bg-slate-700 hover:bg-slate-600 px-3 py-2 text-sm" title="Tag/Nacht umschalten">üåó</button>
      </div>
    </header>

    <!-- Connection Section -->
    <section class="mt-6 grid md:grid-cols-3 gap-4">
      <div class="col-span-2 bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
        <h2 class="font-semibold mb-3">Verbindung</h2>
        <form class="grid sm:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm mb-1">TikTok @user</label>
            <input id="tiktok_user" placeholder="@deinname"
                   class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
          </div>
          <div class="flex items-end gap-2">
            <button id="btnConnect" type="button" class="rounded-xl bg-emerald-600 hover:bg-emerald-500 px-4 py-2 font-medium">Verbinden</button>
            <button id="btnDisconnect" type="button" class="rounded-xl bg-rose-600 hover:bg-rose-500 px-4 py-2 font-medium">Trennen</button>
            <button id="btnUpdateGifts" type="button" class="rounded-xl bg-sky-600 hover:bg-sky-500 px-4 py-2 font-medium">Gifts aktualisieren</button>
          </div>
        </form>
        <div class="mt-2">
          <span id="giftStatus" class="text-sm text-slate-400"></span>
        </div>
      </div>

      <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
        <h2 class="font-semibold mb-3">Audio-Test</h2>
        <div class="space-y-2">
          <input id="test_url" placeholder="MP3-URL zum Testen" class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
          <button id="btnTest" class="w-full rounded-xl bg-indigo-600 hover:bg-indigo-500 px-4 py-2 font-medium">Abspielen</button>
        </div>
      </div>
    </section>

    <!-- Event Sounds & Playback Settings -->
    <section class="mt-6 grid lg:grid-cols-2 gap-4">
      <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
        <h3 class="font-semibold mb-3">Event-Sounds & Wiedergabe</h3>
        <div class="space-y-4">
          <!-- Follow Sound -->
          <div>
            <label class="block text-sm mb-1">Follow-Sound</label>
            <div class="flex gap-2 items-center">
              <input id="follow_sound" placeholder="MP3-URL"
                     class="flex-1 rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
              <input id="follow_volume" type="range" min="0" max="1" step="0.05" value="1.0" class="w-20" title="Lautst√§rke" />
              <button class="rounded-xl bg-amber-600 hover:bg-amber-500 px-3 py-2" data-action="preview-sound" data-sound-id="follow_sound" data-volume-id="follow_volume" data-label="Follow">‚ñ∂</button>
              <button class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2" data-action="open-picker" data-target="follow_sound">Picker</button>
            </div>
          </div>

          <!-- Subscribe Sound -->
          <div>
            <label class="block text-sm mb-1">Subscribe-Sound</label>
            <div class="flex gap-2 items-center">
              <input id="subscribe_sound" placeholder="MP3-URL"
                     class="flex-1 rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
              <input id="subscribe_volume" type="range" min="0" max="1" step="0.05" value="1.0" class="w-20" title="Lautst√§rke" />
              <button class="rounded-xl bg-amber-600 hover:bg-amber-500 px-3 py-2" data-action="preview-sound" data-sound-id="subscribe_sound" data-volume-id="subscribe_volume" data-label="Subscribe">‚ñ∂</button>
              <button class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2" data-action="open-picker" data-target="subscribe_sound">Picker</button>
            </div>
          </div>

          <!-- Share Sound -->
          <div>
            <label class="block text-sm mb-1">Share-Sound</label>
            <div class="flex gap-2 items-center">
              <input id="share_sound" placeholder="MP3-URL"
                     class="flex-1 rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
              <input id="share_volume" type="range" min="0" max="1" step="0.05" value="1.0" class="w-20" title="Lautst√§rke" />
              <button class="rounded-xl bg-amber-600 hover:bg-amber-500 px-3 py-2" data-action="preview-sound" data-sound-id="share_sound" data-volume-id="share_volume" data-label="Share">‚ñ∂</button>
              <button class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2" data-action="open-picker" data-target="share_sound">Picker</button>
            </div>
          </div>

          <!-- Like Settings -->
          <div class="grid sm:grid-cols-3 gap-2">
            <div>
              <label class="block text-sm mb-1">Like-Schwelle</label>
              <input id="like_threshold" type="number" min="0" value="20" class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm mb-1">Zeitraum (Sek.)</label>
              <input id="like_window_seconds" type="number" min="1" value="10" class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
            </div>
            <div class="flex flex-col gap-1">
              <label class="block text-sm mb-1">Like-Sound</label>
              <div class="flex gap-2 items-center">
                <input id="like_sound" placeholder="MP3-URL" class="flex-1 rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
                <input id="like_volume" type="range" min="0" max="1" step="0.05" value="1.0" class="w-20" title="Lautst√§rke" />
              </div>
              <div class="flex gap-2">
                <button class="rounded-lg bg-amber-600 hover:bg-amber-500 px-3 py-1.5" data-action="preview-sound" data-sound-id="like_sound" data-volume-id="like_volume" data-label="Like">‚ñ∂</button>
                <button class="rounded-lg bg-sky-600 hover:bg-sky-500 px-3 py-1.5" data-action="open-picker" data-target="like_sound">Picker</button>
              </div>
            </div>
          </div>

          <!-- Default Gift Sound -->
          <div class="border-t border-slate-800 pt-4">
            <label class="block text-sm mb-1">Standard-Gift-Sound (f√ºr nicht zugeordnete Gifts)</label>
            <div class="flex gap-2 items-center">
              <input id="default_gift_sound" placeholder="MP3-URL"
                     class="flex-1 rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
              <input id="default_gift_volume" type="range" min="0" max="1" step="0.05" value="1.0" class="w-20" title="Lautst√§rke" />
              <button class="rounded-xl bg-amber-600 hover:bg-amber-500 px-3 py-2" data-action="preview-sound" data-sound-id="default_gift_sound" data-volume-id="default_gift_volume" data-label="Default Gift">‚ñ∂</button>
              <button class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2" data-action="open-picker" data-target="default_gift_sound">Picker</button>
            </div>
            <p class="text-xs text-slate-400 mt-1">Dieser Sound wird f√ºr alle Gifts abgespielt, die keine spezielle Zuordnung haben.</p>
          </div>

          <!-- Playback Settings -->
          <div class="grid sm:grid-cols-3 gap-2 border-t border-slate-800 pt-4">
            <div>
              <label class="block text-sm mb-1">Queue‚ÄëL√§nge</label>
              <input id="queue_length" type="number" min="1" value="10" class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm mb-1">Wiedergabe-Modus</label>
              <select id="play_mode" class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2">
                <option value="overlap">√úberlappend</option>
                <option value="sequential">Nacheinander</option>
              </select>
            </div>
          </div>

          <div class="flex justify-end gap-2">
            <button id="btnReset" class="rounded-xl bg-slate-700 hover:bg-slate-600 px-4 py-2 font-medium" title="√Ñnderungen verwerfen">Reset</button>
            <label for="importFile" class="rounded-xl bg-purple-700 hover:bg-purple-600 px-4 py-2 font-medium cursor-pointer">Import</label>
            <input type="file" id="importFile" accept="application/json" class="hidden" />
            <button id="btnExport" class="rounded-xl bg-sky-700 hover:bg-sky-600 px-4 py-2 font-medium">Export</button>
            <button id="btnSaveAll" class="rounded-xl bg-emerald-600 hover:bg-emerald-500 px-4 py-2 font-medium">Alles speichern</button>
          </div>
        </div>
      </div>

      <!-- Gifts ‚Üí Audio -->
      <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
        <h3 class="font-semibold mb-3">Geschenke ‚Üí Audio</h3>
        <div class="flex flex-wrap items-center gap-2 mb-3">
          <input id="giftSearch" placeholder="Geschenk suchen ‚Ä¶ (Name oder ID)"
                 class="rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 flex-1 min-w-[220px]" />
          <label class="text-sm text-slate-300">Sortierung:</label>
          <select id="giftSort" class="rounded-xl bg-slate-800 border border-slate-700 px-3 py-2">
            <option value="desc">Preis absteigend</option>
            <option value="asc">Preis aufsteigend</option>
          </select>
        </div>

        <!-- Bulk Actions Toolbar -->
        <div id="bulkToolbar" class="hidden bg-sky-900/30 border border-sky-700/50 rounded-xl p-2 mb-3">
          <div class="flex items-center gap-2 flex-wrap">
            <span id="bulkCount" class="text-sm font-medium">0 ausgew√§hlt</span>
            <button id="btnBulkAssign" class="rounded-lg bg-sky-600 hover:bg-sky-500 px-3 py-1 text-sm">Sound zuweisen</button>
            <button id="btnBulkClear" class="rounded-lg bg-rose-600 hover:bg-rose-500 px-3 py-1 text-sm">L√∂schen</button>
            <button id="btnBulkSelectAll" class="rounded-lg bg-slate-700 hover:bg-slate-600 px-3 py-1 text-sm">Alle</button>
            <button id="btnBulkSelectNone" class="rounded-lg bg-slate-700 hover:bg-slate-600 px-3 py-1 text-sm">Keine</button>
            <button id="btnBulkSelectAssigned" class="rounded-lg bg-slate-700 hover:bg-slate-600 px-3 py-1 text-sm">Zugeordnete</button>
          </div>
        </div>

        <div id="giftList" class="max-h-[32rem] overflow-y-auto pr-1 scroll-shadow space-y-2"></div>
        <p class="text-xs text-slate-400 mt-2">Nur Gifts mit gesetzter MP3 werden gespeichert. <span class="text-sky-400">Tipp: Strg+Z/Y f√ºr Undo/Redo</span></p>
      </div>
    </section>

    <!-- Live Log & Info -->
    <section class="mt-6 grid lg:grid-cols-2 gap-4">
      <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
        <h3 class="font-semibold mb-3">Live-Log</h3>
        <pre id="log" class="h-72 overflow-y-auto bg-black/40 rounded-xl p-3 text-xs"></pre>
      </div>
      <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
        <h3 class="font-semibold mb-3">Hinweise</h3>
        <ul class="text-sm list-disc pl-5 space-y-2 text-slate-300">
          <li>OBS: Diese Seite als Browserquelle einbinden f√ºr Audioausgabe.</li>
          <li>Gift-Liste ist nach Diamond-Preis sortierbar und per Text filterbar.</li>
          <li>Audio-Auswahl per Picker-Dialog. Alternativ direkte MP3-URL einf√ºgen.</li>
          <li>Live-Updates via WebSocket f√ºr Echtzeit-Synchronisation.</li>
          <li><a href="/dashboard.html" class="text-sky-400 hover:underline">Zum Dashboard ‚Üí</a></li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Picker Modal -->
  <div id="picker" class="fixed inset-0 bg-black/70 hidden items-center justify-center p-4 z-50">
    <div class="bg-slate-900 w-full max-w-5xl h-[80vh] rounded-2xl border border-slate-800 p-4 flex flex-col">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2 flex-wrap">
          <button class="tab-btn rounded-lg px-3 py-2 bg-slate-800" aria-selected="true" data-action="switch-tab" data-tab="browse">Browser</button>
          <button class="tab-btn rounded-lg px-3 py-2 bg-slate-800" aria-selected="false" data-action="switch-tab" data-tab="search">üîç Suche</button>
          <button class="tab-btn rounded-lg px-3 py-2 bg-slate-800" aria-selected="false" data-action="switch-tab" data-tab="favorites">‚≠ê Favoriten</button>
          <button class="tab-btn rounded-lg px-3 py-2 bg-slate-800" aria-selected="false" data-action="switch-tab" data-tab="trending">üî• Trending</button>
          <button class="tab-btn rounded-lg px-3 py-2 bg-slate-800" aria-selected="false" data-action="switch-tab" data-tab="random">üé≤ Zufall</button>
        </div>
        <button data-action="close-picker" class="text-slate-300 hover:text-white text-xl">‚úï</button>
      </div>

      <!-- Browser Tab -->
      <div class="flex-1 flex flex-col gap-3" id="tab-browse">
        <div class="flex gap-2">
          <input id="miUrl" placeholder="MyInstants-URL einf√ºgen & aufl√∂sen"
                 class="flex-1 rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
          <button id="btnResolve" class="rounded-xl bg-emerald-600 hover:bg-emerald-500 px-3 py-2">Seite ‚Üí MP3</button>
          <button id="btnUse" class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2">√úbernehmen</button>
        </div>
        <iframe id="miFrame" src="https://www.myinstants.com" class="w-full h-full rounded-xl border border-slate-700"></iframe>
      </div>

      <!-- Search Tab -->
      <div class="flex-1 flex-col gap-3 hidden" id="tab-search">
        <div class="flex gap-2 mb-3">
          <input id="searchQuery" placeholder="Live-Suche (tippe zum Suchen)..."
                 class="flex-1 rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
          <button id="btnSearch" class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2">üîç Suchen</button>
          <button id="btnClearCache" class="rounded-xl bg-slate-700 hover:bg-slate-600 px-3 py-2" title="Cache leeren">üóëÔ∏è</button>
        </div>
        <div class="mb-2">
          <div class="text-xs text-slate-400 mb-2">üè∑Ô∏è Beliebte Kategorien:</div>
          <div class="flex flex-wrap gap-1" id="popularCategories">
            <button class="px-3 py-1 rounded-full bg-slate-700 hover:bg-sky-600 text-xs transition-colors" data-action="filter-category" data-category="meme">meme</button>
            <button class="px-3 py-1 rounded-full bg-slate-700 hover:bg-sky-600 text-xs transition-colors" data-action="filter-category" data-category="funny">funny</button>
            <button class="px-3 py-1 rounded-full bg-slate-700 hover:bg-sky-600 text-xs transition-colors" data-action="filter-category" data-category="music">music</button>
            <button class="px-3 py-1 rounded-full bg-slate-700 hover:bg-sky-600 text-xs transition-colors" data-action="filter-category" data-category="sound effect">sound effect</button>
            <button class="px-3 py-1 rounded-full bg-slate-700 hover:bg-sky-600 text-xs transition-colors" data-action="filter-category" data-category="anime">anime</button>
            <button class="px-3 py-1 rounded-full bg-slate-700 hover:bg-sky-600 text-xs transition-colors" data-action="filter-category" data-category="gaming">gaming</button>
            <button class="px-3 py-1 rounded-full bg-slate-700 hover:bg-sky-600 text-xs transition-colors" data-action="filter-category" data-category="movie">movie</button>
          </div>
        </div>
        <div id="searchResults" class="overflow-y-auto flex-1 space-y-2"></div>
      </div>

      <!-- Favorites Tab -->
      <div class="flex-1 flex-col gap-3 hidden" id="tab-favorites">
        <div class="flex gap-2 mb-3 justify-between items-center">
          <h3 class="text-lg font-semibold">‚≠ê Deine Favoriten</h3>
          <button id="btnClearFavorites" class="rounded-xl bg-rose-600 hover:bg-rose-500 px-3 py-2">Alle l√∂schen</button>
        </div>
        <div id="favoritesResults" class="overflow-y-auto flex-1 space-y-2"></div>
      </div>

      <!-- Trending Tab -->
      <div class="flex-1 flex-col gap-3 hidden" id="tab-trending">
        <div class="flex gap-2 mb-3 justify-between items-center">
          <h3 class="text-lg font-semibold">üî• Trending Sounds</h3>
          <button id="btnLoadTrending" class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2">Aktualisieren</button>
        </div>
        <div id="trendingResults" class="overflow-y-auto flex-1 space-y-2"></div>
      </div>

      <!-- Random Tab -->
      <div class="flex-1 flex-col gap-3 hidden" id="tab-random">
        <div class="flex gap-2 mb-3 justify-between items-center">
          <h3 class="text-lg font-semibold">üé≤ Zuf√§llige Sounds</h3>
          <button id="btnLoadRandom" class="rounded-xl bg-sky-600 hover:bg-sky-500 px-3 py-2">Neu laden</button>
        </div>
        <div id="randomResults" class="overflow-y-auto flex-1 space-y-2"></div>
      </div>
    </div>
  </div>

  <!-- Load audio unlock system first to handle autoplay restrictions -->
  <script src="/js/audio-unlock.js"></script>

  <script src="/js/soundboard.js"></script>

  <!-- Dashboard Preview Client for audio preview system -->
  <script src="/dashboard_preview.js"></script>

  <!-- Hidden Audio Pool for reliable playback -->
  <div id="soundboard-audio-pool" style="display: none;"></div>

  <!-- Preview Audio Player (hidden by default, shown when preview is active) -->
  <audio id="preview-audio" controls style="display: none; position: fixed; bottom: 20px; right: 20px; z-index: 9999; background: rgba(0,0,0,0.8); border-radius: 8px; padding: 8px;"></audio>
</body>
</html>
