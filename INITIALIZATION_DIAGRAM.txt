â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               GLOBAL INITIALIZATION SEQUENCE - TIMING DIAGRAM                 â•‘
â•‘            Pup Cid's Little TikTok Helper - Race Conditions Shown             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TIMEâ†’
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

[SERVER PROCESS]
â”œâ”€ T+0ms:     Node.js process starts (server.js)
â”œâ”€ T+10ms:    UserProfileManager init
â”œâ”€ T+15ms:    Database init
â”œâ”€ T+20ms:    TikTokConnector init
â”œâ”€ T+25ms:    AlertManager init
â”œâ”€ T+30ms:    FlowEngine init
â”œâ”€ T+35ms:    GoalManager init
â”œâ”€ T+40ms:    Other modules init (Leaderboard, UpdateManager, etc)
â”œâ”€ T+50ms:    Express/Socket.io configured
â”‚
â”œâ”€ T+50ms:    ğŸ”´ ASYNC IIFE STARTS (loadAllPlugins)
â”œâ”€ T+55ms:       â”œâ”€ Scan /plugins directory
â”œâ”€ T+60ms:       â”œâ”€ Load plugin manifests
â”œâ”€ T+70ms:       â”œâ”€ Validate & instantiate plugins
â”œâ”€ T+80ms:       â”œâ”€ Call each plugin.init() [ASYNC]
â”œâ”€ T+90ms:       â””â”€ Save plugins_state.json
â”‚
â”œâ”€ T+95ms:    ğŸŸ¢ registerPluginTikTokEvents(tiktok)
â”œâ”€ T+100ms:   ğŸŸ¢ Plugin injections (vdoninja, osc-bridge, tts)
â”‚             âš ï¸ ISSUE: plugin.init() may still be running!
â”‚
â”œâ”€ T+105ms:   ğŸŸ¢ server.listen(3000) starts
â”œâ”€ T+110ms:   âœ… Server ready, listening for connections
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[BROWSER PROCESS] (Parallel to server)
â”œâ”€ T+1000ms: Browser loads dashboard.html
â”œâ”€ T+1010ms: Parse <script src="audio-unlock.js">
â”‚            â”œâ”€ new AudioUnlockManager()  [EXECUTES IMMEDIATELY]
â”‚            â”œâ”€ window.audioUnlockManager = [set]
â”‚            â””â”€ window.audioUnlocked = false
â”‚
â”œâ”€ T+1020ms: Parse <script src="dashboard.js">
â”‚            â”œâ”€ let socket = null;  [declared]
â”‚            â”œâ”€ let settings = {};  [declared]
â”‚            â””â”€ DOMContentLoaded listener registered
â”‚
â”œâ”€ T+1030ms: Parse <script src="navigation.js">
â”‚            â””â”€ DOMContentLoaded listener registered
â”‚
â”œâ”€ T+1040ms: Parse <script src="dashboard-enhancements.js">
â”‚            â””â”€ DOMContentLoaded listener registered
â”‚
â”œâ”€ T+1050ms: Parse <script src="plugin-manager.js">
â”œâ”€ T+1060ms: Parse <script src="update-checker.js">
â”œâ”€ T+1070ms: Parse <script src="audio-settings.js">
â”‚
â”œâ”€ T+1080ms: DOMContentLoaded fires
â”‚            â”‚
â”‚            â”œâ”€ dashboard.js listener:
â”‚            â”‚  â”œâ”€ socket = io()  [CREATE CONNECTION]
â”‚            â”‚  â”œâ”€ initializeButtons()
â”‚            â”‚  â”œâ”€ initializeSocketListeners()
â”‚            â”‚  â”œâ”€ loadSettings() [ASYNC, not awaited]
â”‚            â”‚  â”œâ”€ loadFlows() [ASYNC, not awaited]
â”‚            â”‚  â””â”€ loadActiveProfile() [ASYNC, not awaited]
â”‚            â”‚
â”‚            â”œâ”€ navigation.js listener:
â”‚            â”‚  â”œâ”€ initializeSidebar()
â”‚            â”‚  â”œâ”€ initializeNavigation()
â”‚            â”‚  â”œâ”€ initializeShortcuts()
â”‚            â”‚  â”œâ”€ initializePluginVisibility()
â”‚            â”‚  â””â”€ lucide.createIcons()
â”‚            â”‚
â”‚            â””â”€ dashboard-enhancements.js listener:
â”‚               â”œâ”€ initializeQuickActionButtons() [ASYNC, not awaited]
â”‚               â”œâ”€ initializeFAQAccordion()
â”‚               â”œâ”€ initializeChangelog()
â”‚               â”œâ”€ initializeCompactResources()
â”‚               â”œâ”€ initializeRuntimeTracking()
â”‚               â”œâ”€ initializeResourceDetailsLink()
â”‚               â””â”€ lucide.createIcons()
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[SOCKET.IO CONNECTION] (Browser â†’ Server)
â”œâ”€ T+1085ms: Socket connection established
â”‚
â”œâ”€ T+1090ms: Server: io.on('connection', (socket) => {
â”‚            â”œâ”€ pluginLoader.registerPluginSocketEvents(socket)
â”‚            â”‚  â””â”€ Register ALL plugin socket handlers for THIS socket
â”‚            â”‚     âš ï¸ RACE CONDITION: Plugins may not be fully initialized!
â”‚            â”‚
â”‚            â”œâ”€ socket.on('goal:join')
â”‚            â”œâ”€ socket.on('leaderboard:join')
â”‚            â”œâ”€ socket.on('disconnect')
â”‚            â””â”€ socket.on('test:alert')
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ASYNC LOADING IN PARALLEL]
â”œâ”€ T+1090ms: loadSettings() 
â”‚            â””â”€ T+1150ms: Settings loaded, global 'settings' updated
â”‚
â”œâ”€ T+1090ms: loadFlows()
â”‚            â””â”€ T+1150ms: Flows rendered in #flows-list
â”‚
â””â”€ T+1090ms: loadActiveProfile()
             â””â”€ T+1150ms: Profile name updated in UI

[PLUGIN STATE]
â”œâ”€ T+80ms:   plugin.init() [ASYNC] - Still may be running
â”‚            â”œâ”€ TTS: Loading voices
â”‚            â”œâ”€ Emoji-Rain: Setting up canvas
â”‚            â”œâ”€ OSC-Bridge: Starting server
â”‚            â””â”€ Goals: Initializing overlays
â”‚
â”œâ”€ T+100ms:  Plugin injections attempted
â”‚            â”œâ”€ flows.vdoninjaManager = vdoninjaPlugin.getManager()
â”‚            â”‚  âš ï¸ IF plugin.init() not done: getManager() may fail
â”‚            â””â”€ flows.oscBridge = oscBridgePlugin.getOSCBridge()
â”‚               âš ï¸ IF plugin.init() not done: getOSCBridge() may fail
â”‚
â””â”€ T+150ms+: Plugins fully initialized (when all async work done)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          KEY RACE CONDITIONS                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£

âš ï¸ RC#1: Plugin Init Not Fully Awaited
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Server (T+80-100ms):      plugin.init() still running
Server (T+100ms):         Attempt: flows.vdoninjaManager = vdoninja.getManager()
                          âš ï¸ Returns undefined if init() not done!
                          
FIX: Wait for all plugin init() to resolve before injections


âš ï¸ RC#2: Settings/Flows/Profile Not Awaited
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Browser (T+1080ms):       loadSettings() called without await
Browser (T+1090ms):       Code continues immediately
Browser (T+1150ms):       Settings actually available
                          âš ï¸ Any code using settings before T+1150 gets empty object!
                          
FIX: Use Promise.all() or chain with .then()


âš ï¸ RC#3: Socket Connected Before All Plugin Handlers Ready
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Browser (T+1080ms):       DOMContentLoaded fires
Browser (T+1085ms):       socket = io() creates connection
Server (T+1090ms):        io.on('connection') fires
Server (T+1090ms):        pluginLoader.registerPluginSocketEvents(socket)

IF plugin.init() hasn't finished:
  - Plugin socket handlers not registered
  - Client sends message â†’ handler not found â†’ no response
  - Silent failure or error
                          
FIX: Don't register socket until plugins fully initialized


âš ï¸ RC#4: Audio Unlock Before Audio Playback
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Global scope (T+1010ms): window.audioUnlocked = false
Plugin (T+1200ms):       TTS tries to play audio
                         âš ï¸ Audio may not be unlocked yet!
                         
FIX: Check window.audioUnlocked or use event listener


âš ï¸ RC#5: Multiple DOMContentLoaded Listeners (Order Undefined)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Browser (T+1080ms):       ALL three listeners fire simultaneously:
                          - dashboard.js:10
                          - navigation.js:14
                          - dashboard-enhancements.js:16
                          
                          âš ï¸ No guaranteed order!
                          If initializeQuickActionButtons() runs before
                          loadSettings(), settings will be empty.
                          
FIX: Sequential initialization with event/promise chain

â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY FILES WITH ISSUES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. /server.js
   - Lines 1631-1668: Plugin loading before server starts
   - Lines 1643-1662: Plugin injections without validation

2. /public/js/dashboard.js
   - Lines 19-21: Async loads not awaited
   - Line 12: socket.io() without waiting for DOM fully ready

3. /public/js/navigation.js
   - Lines 14-24: DOMContentLoaded listener with no coordination

4. /public/js/dashboard-enhancements.js
   - Lines 16-28: DOMContentLoaded listener with no coordination
   - Line 31: initializeQuickActionButtons() async but not awaited

5. /modules/plugin-loader.js
   - Lines 469-479: plugin.init() called but not validated
   - No error handling if init() fails

6. /public/js/audio-unlock.js
   - Lines 1-16: Global initialization before user interaction
   - No event for when audio is ready

INITIALIZATION STATES AT KEY TIMES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

T+100ms (Server):
  âœ… Modules initialized
  âœ… Plugins loaded (instances created)
  âš ï¸ plugin.init() [async] - may still running
  âœ… TikTok event handlers registered
  âœ… Socket.io listening
  
T+1080ms (Browser):
  âœ… All scripts parsed
  âœ… DOM fully rendered
  âš ï¸ socket created
  âš ï¸ Settings not loaded yet
  âš ï¸ Flows not loaded yet
  âš ï¸ Profile not loaded yet

T+1150ms (Browser):
  âœ… Settings loaded
  âœ… Flows loaded
  âœ… Profile loaded
  âš ï¸ UI still may be referencing undefined settings

