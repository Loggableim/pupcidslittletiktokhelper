{"version":3,"file":"types.js","sourceRoot":"","sources":["../../src/client/types.ts"],"names":[],"mappings":"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","sourcesContent":["import {z} from \"zod\";\nimport {DecodedData, SchemaVersion} from \"../webcast\";\nimport {coerceBoolean, coerceNumber} from \"../extras/zod-extra\";\n\nexport enum ClientCloseCode {\n\n  /**\n   * Responding to a client's close request normally\n   */\n  NORMAL = 1000,\n\n  /**\n   * Error updating presence on connect, or upstream error on connect in the proxy.\n   */\n  INTERNAL_SERVER_ERROR = 1011,\n\n  /**\n   * Error fetching the /webcast/fetch endpoint for the socket\n   */\n  WEBCAST_FETCH_ERROR = 4556,\n\n  /**\n   * Error fetching the /webcast/room_info endpoint for the socket\n   */\n  ROOM_INFO_FETCH_ERROR = 4557,\n\n  /**\n   * TikTok closed the connected unexpectedly.\n   */\n  TIKTOK_CLOSED_CONNECTION = 4500,\n\n  /**\n   * The account has too many connections.\n   */\n  TOO_MANY_CONNECTIONS = 4429,\n\n  /**\n   * The client provided invalid options, such as an invalid uniqueId or JWT key.\n   */\n  INVALID_OPTIONS = 4400,\n\n  /**\n   * The requested streamer is not live.\n   */\n  NOT_LIVE = 4404,\n\n  /**\n   * The TikTok stream ended.\n   */\n  STREAM_END = 4005,\n\n  /**\n   * There were no messages in the timeout period, the WebSocket was assumed dead and closed.\n   */\n  NO_MESSAGES_TIMEOUT = 4006,\n\n  /**\n   * Invalid Auth\n   */\n  INVALID_AUTH = 4401,\n\n  /**\n   * Accessing a creator the JWT has no access to\n   */\n  NO_PERMISSION = 4403,\n\n  /**\n   * WebSocket exceeded 8 hour lifetime\n   */\n  MAX_LIFETIME_EXCEEDED = 4555,\n\n}\n\n// Short descriptions that can be sent over WebSocket close reason\nexport const CloseMessageMap: Record<ClientCloseCode, string> = {\n  [ClientCloseCode.ROOM_INFO_FETCH_ERROR]: \"Error fetching /webcast/room_info\",\n  [ClientCloseCode.WEBCAST_FETCH_ERROR]: \"Error fetching /webcast/fetch\",\n  [ClientCloseCode.INVALID_AUTH]: \"Invalid auth\",\n  [ClientCloseCode.MAX_LIFETIME_EXCEEDED]: \"Max lifetime exceeded\",\n  [ClientCloseCode.NO_PERMISSION]: \"No permission\",\n  [ClientCloseCode.INTERNAL_SERVER_ERROR]: \"Internal server error\",\n  [ClientCloseCode.TIKTOK_CLOSED_CONNECTION]: \"TikTok closed the connection unexpectedly\",\n  [ClientCloseCode.TOO_MANY_CONNECTIONS]: \"Too many concurrent connections\",\n  [ClientCloseCode.INVALID_OPTIONS]: \"Invalid options provided\",\n  [ClientCloseCode.NOT_LIVE]: \"Streamer is not live\",\n  [ClientCloseCode.STREAM_END]: \"TikTok stream ended\",\n  [ClientCloseCode.NO_MESSAGES_TIMEOUT]: \"No messages received in timeout period, closing WebSocket\",\n  [ClientCloseCode.NORMAL]: \"Normal closure\"\n}\n\nexport const WebSocketFeatureFlags = z.object({\n\n  /**\n   * When enabled, the client will bundle multiple messages into a single event. This is more efficient\n   * than sending messages individually.\n   */\n  bundleEvents: coerceBoolean({default: true}),\n\n  /**\n   * When enabled, the client will act as a pass-through proxy for raw messages. You will lose out on\n   * additional features like presence messages, but this will fit nicely into existing libraries.\n   */\n  rawMessages: coerceBoolean({default: false}),\n\n  /**\n   * Whether to normalize uniqueIds in URL format, @uniqueId format, etc., or treat them as-is.\n   */\n  normalizeUniqueId: coerceBoolean({default: true}),\n\n  /**\n   * When enabled, the client will calculate presence information for users in the room.\n   * This enables us to give custom SyntheticJoinMessage and SyntheticLeaveMessage, a full presence system.\n   */\n  syntheticPresence: coerceBoolean({default: false}),\n\n  /**\n   * Configures how long a user must be inactive before we send a SyntheticLeaveMessage.\n   */\n  syntheticPresenceLeaveAfter: coerceNumber({default: 300, min: 60, max: 3600}),\n\n  /**\n   * Configures how long we can wait with NO messages coming from TikTok before we assume the WebSocket\n   * is dead and close it.\n   */\n  closeInactiveWebSocketAfter: coerceNumber({default: 60, min: 30, max: 3600}),\n\n  /**\n   * The TikTok protobuf schema version to use for decoding messages.\n   */\n  schemaVersion: z.nativeEnum(SchemaVersion).default(SchemaVersion.v2),\n\n  /**\n   * Whether to add a \"raw\" entry including base64 encoded Protobuf with the JSON\n   */\n  includeRawBytes: coerceBoolean({default: false}),\n\n  /**\n   * Whether to use the Enterprise Sign API infrastructure (recommended)\n   */\n  useEnterpriseApi: coerceBoolean({default: false})\n\n});\n\nexport const WebSocketOptionsSchema = z.object({\n  uniqueId: z.string(),\n  jwtKey: z.string().optional().nullable(),\n  apiKey: z.string().optional().nullable(),\n  features: WebSocketFeatureFlags.default({})\n});\n\nexport type ParsedWebSocketOptions = Omit<z.infer<typeof WebSocketOptionsSchema>, 'features'> & {\n  features: WebSocketFeatureFlagsType\n};\nexport type WebSocketFeatureFlagsType = z.infer<typeof WebSocketFeatureFlags>;\nexport type WebSocketOptions = Omit<ParsedWebSocketOptions, 'features'> & {\n  features?: Partial<WebSocketFeatureFlagsType>\n};\n\nexport type ClientMessageBundle = {\n  timestamp: number,\n  messages: DecodedData[]\n}\n\n\n"]}