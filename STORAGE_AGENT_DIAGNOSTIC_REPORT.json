{
  "reportMetadata": {
    "generatedAt": "2025-11-14T00:00:00Z",
    "agent": "Storage-Agent",
    "projectPath": "/home/user/pupcidslittletiktokhelper",
    "analysisVersion": "1.0.0"
  },
  "executiveSummary": {
    "totalJsonFiles": 19,
    "validJsonFiles": 19,
    "invalidJsonFiles": 0,
    "totalJsonParseOperations": 45,
    "jsonParseWithErrorHandling": 35,
    "jsonParseWithoutErrorHandling": 10,
    "criticalIssues": 3,
    "warnings": 7,
    "recommendations": 12
  },
  "jsonFilesValidation": {
    "summary": {
      "totalFiles": 19,
      "validFiles": 19,
      "invalidFiles": 0,
      "corruptedFiles": 0
    },
    "files": {
      "pluginManifests": {
        "plugins/multicam/plugin.json": {
          "status": "VALID",
          "size": 378,
          "type": "plugin-manifest",
          "pluginId": "multicam",
          "enabled": false
        },
        "plugins/vdoninja/plugin.json": {
          "status": "VALID",
          "size": 415,
          "type": "plugin-manifest",
          "pluginId": "vdoninja",
          "enabled": false
        },
        "plugins/soundboard/plugin.json": {
          "status": "VALID",
          "size": 354,
          "type": "plugin-manifest",
          "pluginId": "soundboard",
          "enabled": true
        },
        "plugins/tts/plugin.json": {
          "status": "VALID",
          "size": 1047,
          "type": "plugin-manifest",
          "pluginId": "tts",
          "enabled": true
        },
        "plugins/osc-bridge/plugin.json": {
          "status": "VALID",
          "size": 670,
          "type": "plugin-manifest",
          "pluginId": "osc-bridge",
          "enabled": false
        },
        "plugins/goals/plugin.json": {
          "status": "VALID",
          "size": 361,
          "type": "plugin-manifest",
          "pluginId": "goals",
          "enabled": true
        },
        "plugins/gift-milestone/plugin.json": {
          "status": "VALID",
          "size": 400,
          "type": "plugin-manifest",
          "pluginId": "gift-milestone",
          "enabled": false
        },
        "plugins/emoji-rain/plugin.json": {
          "status": "VALID",
          "size": 324,
          "type": "plugin-manifest",
          "pluginId": "emoji-rain",
          "enabled": true
        },
        "plugins/api-bridge/plugin.json": {
          "status": "VALID",
          "size": 309,
          "type": "plugin-manifest",
          "pluginId": "api-bridge",
          "enabled": true
        },
        "plugins/hybridshock/plugin.json": {
          "status": "VALID",
          "size": 550,
          "type": "plugin-manifest",
          "pluginId": "hybridshock",
          "enabled": true
        },
        "plugins/openshock/plugin.json": {
          "status": "VALID",
          "size": 3922,
          "type": "plugin-manifest",
          "pluginId": "openshock",
          "enabled": true
        },
        "plugins/quiz_show/plugin.json": {
          "status": "VALID",
          "size": 1053,
          "type": "plugin-manifest",
          "pluginId": "quiz-show",
          "enabled": true
        },
        "plugins/resource-monitor/plugin.json": {
          "status": "VALID",
          "size": 330,
          "type": "plugin-manifest",
          "pluginId": "resource-monitor",
          "enabled": true
        }
      },
      "pluginState": {
        "plugins/plugins_state.json": {
          "status": "VALID",
          "size": 284,
          "type": "plugin-state",
          "purpose": "Global plugin enabled/disabled state tracking",
          "trackedPlugins": ["soundboard", "tts", "emoji-rain", "openshock"]
        }
      },
      "configuration": {
        "plugins/hybridshock/example-mappings.json": {
          "status": "VALID",
          "size": 7023,
          "type": "example-data",
          "purpose": "HybridShock event mapping examples"
        }
      },
      "localization": {
        "locales/en.json": {
          "status": "VALID",
          "size": 3919,
          "type": "i18n"
        },
        "locales/de.json": {
          "status": "VALID",
          "size": 4422,
          "type": "i18n"
        },
        "locales/es.json": {
          "status": "VALID",
          "size": 787,
          "type": "i18n"
        },
        "locales/fr.json": {
          "status": "VALID",
          "size": 818,
          "type": "i18n"
        }
      }
    }
  },
  "jsonParseOperations": {
    "summary": {
      "totalOperations": 45,
      "withErrorHandling": 35,
      "withoutErrorHandling": 10,
      "riskLevel": "MEDIUM"
    },
    "locations": [
      {
        "file": "/home/user/pupcidslittletiktokhelper/test-resource-monitor.js",
        "line": 43,
        "code": "JSON.parse(fs.readFileSync(manifestPath, 'utf8'))",
        "errorHandling": "NONE",
        "riskLevel": "HIGH",
        "context": "Test file - manifest loading",
        "recommendation": "Add try-catch wrapper"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/load-test-speechify.js",
        "line": 110,
        "code": "JSON.parse(statusRes.body)",
        "errorHandling": "NONE",
        "riskLevel": "MEDIUM",
        "context": "Load test - HTTP response parsing",
        "recommendation": "Add try-catch wrapper"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/load-test-speechify.js",
        "line": 162,
        "code": "JSON.parse(r.body).success !== undefined",
        "errorHandling": "NONE",
        "riskLevel": "MEDIUM",
        "context": "Load test - validation check",
        "recommendation": "Add try-catch wrapper"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/load-test-speechify.js",
        "line": 167,
        "code": "JSON.parse(response.body)",
        "errorHandling": "NONE",
        "riskLevel": "MEDIUM",
        "context": "Load test - response parsing",
        "recommendation": "Add try-catch wrapper"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/server.js",
        "line": 1686,
        "code": "JSON.parse(obsConfigStr)",
        "errorHandling": "TRY-CATCH",
        "riskLevel": "LOW",
        "context": "OBS WebSocket auto-connect config loading",
        "recommendation": "Good - has error handling"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/goals.js",
        "line": 165,
        "code": "JSON.parse(raw)",
        "errorHandling": "TRY-CATCH",
        "riskLevel": "LOW",
        "context": "Goal configuration loading",
        "recommendation": "Good - has error handling"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/routes/plugin-routes.js",
        "line": 67,
        "code": "JSON.parse(manifestData)",
        "errorHandling": "OUTER-TRY-CATCH",
        "riskLevel": "LOW",
        "context": "Plugin manifest loading in routes",
        "recommendation": "Good - protected by outer try-catch"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/routes/plugin-routes.js",
        "line": 204,
        "code": "JSON.parse(manifestData)",
        "errorHandling": "OUTER-TRY-CATCH",
        "riskLevel": "LOW",
        "context": "Plugin upload manifest validation",
        "recommendation": "Good - protected by outer try-catch"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/flows.js",
        "line": 286,
        "code": "JSON.parse(body)",
        "errorHandling": "OUTER-TRY-CATCH",
        "riskLevel": "MEDIUM",
        "context": "Webhook body parsing in flows",
        "recommendation": "Consider adding specific JSON parse error handling"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/preset-manager.js",
        "line": 174,
        "code": "JSON.parse(row.value)",
        "errorHandling": "TRY-CATCH-FALLBACK",
        "riskLevel": "LOW",
        "context": "Settings export with fallback",
        "recommendation": "Excellent - has try-catch with fallback to raw value"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/preset-manager.js",
        "line": 426,
        "code": "JSON.parse(row.value)",
        "errorHandling": "TRY-CATCH-FALLBACK",
        "riskLevel": "LOW",
        "context": "Plugin config export with fallback",
        "recommendation": "Excellent - has try-catch with fallback to raw value"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/preset-manager.js",
        "line": 516,
        "code": "JSON.parse(data)",
        "errorHandling": "OUTER-TRY-CATCH",
        "riskLevel": "LOW",
        "context": "Preset file loading",
        "recommendation": "Good - protected by outer try-catch"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/error-handler.js",
        "line": 120,
        "code": "JSON.parse(jsonString)",
        "errorHandling": "TRY-CATCH-DEFAULT",
        "riskLevel": "LOW",
        "context": "Safe JSON parse utility function",
        "recommendation": "Excellent - designed as safe wrapper with default value"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/i18n.js",
        "line": 40,
        "code": "JSON.parse(fs.readFileSync(filePath, 'utf8'))",
        "errorHandling": "TRY-CATCH-FALLBACK",
        "riskLevel": "LOW",
        "context": "Locale file loading with empty object fallback",
        "recommendation": "Good - has error handling with fallback"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/plugin-loader.js",
        "line": 147,
        "code": "JSON.parse(row.value)",
        "errorHandling": "OUTER-TRY-CATCH",
        "riskLevel": "LOW",
        "context": "Plugin config retrieval",
        "recommendation": "Good - protected by outer try-catch"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/plugin-loader.js",
        "line": 297,
        "code": "JSON.parse(data)",
        "errorHandling": "TRY-CATCH-FALLBACK",
        "riskLevel": "LOW",
        "context": "Plugin state file loading with empty object fallback",
        "recommendation": "Good - has error handling with fallback"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/plugin-loader.js",
        "line": 363,
        "code": "JSON.parse(manifestData)",
        "errorHandling": "OUTER-TRY-CATCH",
        "riskLevel": "LOW",
        "context": "Plugin manifest loading during initialization",
        "recommendation": "Good - protected by outer try-catch"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/obs-websocket.js",
        "line": 30,
        "code": "JSON.parse(config)",
        "errorHandling": "TERNARY-FALLBACK",
        "riskLevel": "MEDIUM",
        "context": "OBS config loading with default object",
        "recommendation": "Add proper try-catch - ternary doesn't catch parse errors"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/obs-websocket.js",
        "line": 43,
        "code": "JSON.parse(mappings)",
        "errorHandling": "TERNARY-FALLBACK",
        "riskLevel": "MEDIUM",
        "context": "OBS event mappings loading with empty array",
        "recommendation": "Add proper try-catch - ternary doesn't catch parse errors"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 353,
        "code": "JSON.parse(row.trigger_condition)",
        "errorHandling": "TERNARY-CHECK",
        "riskLevel": "MEDIUM",
        "context": "Flow trigger condition parsing",
        "recommendation": "Add try-catch - could fail on corrupted data"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 354,
        "code": "JSON.parse(row.actions)",
        "errorHandling": "NONE",
        "riskLevel": "HIGH",
        "context": "Flow actions parsing - critical for flow execution",
        "recommendation": "CRITICAL: Add error handling - can crash flow system"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 365,
        "code": "JSON.parse(row.trigger_condition)",
        "errorHandling": "TERNARY-CHECK",
        "riskLevel": "MEDIUM",
        "context": "Single flow trigger condition parsing",
        "recommendation": "Add try-catch - could fail on corrupted data"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 366,
        "code": "JSON.parse(row.actions)",
        "errorHandling": "NONE",
        "riskLevel": "HIGH",
        "context": "Single flow actions parsing",
        "recommendation": "CRITICAL: Add error handling"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 376,
        "code": "JSON.parse(row.trigger_condition)",
        "errorHandling": "TERNARY-CHECK",
        "riskLevel": "MEDIUM",
        "context": "Enabled flows trigger condition parsing",
        "recommendation": "Add try-catch - could fail on corrupted data"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 377,
        "code": "JSON.parse(row.actions)",
        "errorHandling": "NONE",
        "riskLevel": "HIGH",
        "context": "Enabled flows actions parsing",
        "recommendation": "CRITICAL: Add error handling - affects active flows"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 526,
        "code": "JSON.parse(row.data)",
        "errorHandling": "NONE",
        "riskLevel": "MEDIUM",
        "context": "Event log data parsing",
        "recommendation": "Add error handling for corrupted event logs"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 541,
        "code": "JSON.parse(row.config)",
        "errorHandling": "NONE",
        "riskLevel": "HIGH",
        "context": "Profile config parsing",
        "recommendation": "Add error handling - could fail on corrupted profile"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 551,
        "code": "JSON.parse(row.config)",
        "errorHandling": "NONE",
        "riskLevel": "HIGH",
        "context": "Single profile config parsing",
        "recommendation": "Add error handling - could fail on corrupted profile"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 735,
        "code": "JSON.parse(existing.config_json)",
        "errorHandling": "TRY-CATCH-FALLBACK",
        "riskLevel": "LOW",
        "context": "Emoji rain config migration",
        "recommendation": "Good - has try-catch with fallback to defaults"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 808,
        "code": "JSON.parse(row.config_json)",
        "errorHandling": "NONE",
        "riskLevel": "MEDIUM",
        "context": "Emoji rain config retrieval",
        "recommendation": "Add error handling - could fail on corrupted config"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 1034,
        "code": "JSON.parse(row.layout_config)",
        "errorHandling": "NONE",
        "riskLevel": "MEDIUM",
        "context": "VDO.Ninja layout config parsing",
        "recommendation": "Add error handling for corrupted layout data"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 1043,
        "code": "JSON.parse(row.layout_config)",
        "errorHandling": "NONE",
        "riskLevel": "MEDIUM",
        "context": "VDO.Ninja all layouts config parsing",
        "recommendation": "Add error handling for corrupted layout data"
      },
      {
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "line": 1071,
        "code": "JSON.parse(row.event_data)",
        "errorHandling": "NONE",
        "riskLevel": "LOW",
        "context": "VDO.Ninja guest event data parsing",
        "recommendation": "Add error handling for corrupted event data"
      }
    ]
  },
  "criticalIssues": [
    {
      "id": "CRITICAL-001",
      "severity": "CRITICAL",
      "category": "JSON_PARSE_NO_ERROR_HANDLING",
      "title": "Flow Actions Parsing Without Error Handling",
      "description": "Flow actions are parsed from database without error handling in modules/database.js lines 354, 366, 377. If the database contains corrupted JSON for flow actions, the entire flow system could crash.",
      "affectedFiles": [
        "/home/user/pupcidslittletiktokhelper/modules/database.js"
      ],
      "affectedLines": [354, 366, 377],
      "impact": "HIGH - Could crash the flow automation system",
      "exploitability": "MEDIUM - Requires database corruption or malicious data injection",
      "recommendation": "Wrap all JSON.parse() calls in try-catch blocks with appropriate fallback values"
    },
    {
      "id": "CRITICAL-002",
      "severity": "HIGH",
      "category": "JSON_PARSE_NO_ERROR_HANDLING",
      "title": "Profile Config Parsing Without Error Handling",
      "description": "Profile configurations are parsed without error handling in modules/database.js lines 541, 551. Corrupted profile data could crash profile loading.",
      "affectedFiles": [
        "/home/user/pupcidslittletiktokhelper/modules/database.js"
      ],
      "affectedLines": [541, 551],
      "impact": "HIGH - Could prevent users from loading their profiles",
      "exploitability": "LOW - Requires database corruption",
      "recommendation": "Add try-catch with fallback to empty config or default profile"
    },
    {
      "id": "CRITICAL-003",
      "severity": "MEDIUM",
      "category": "JSON_PARSE_TERNARY_PROTECTION",
      "title": "OBS Config Loading Uses Ternary Instead of Try-Catch",
      "description": "OBS configuration loading in modules/obs-websocket.js lines 30, 43 uses ternary operator for null checking but doesn't catch JSON parse errors. Malformed JSON will still crash.",
      "affectedFiles": [
        "/home/user/pupcidslittletiktokhelper/modules/obs-websocket.js"
      ],
      "affectedLines": [30, 43],
      "impact": "MEDIUM - OBS integration could fail to initialize",
      "exploitability": "MEDIUM - Requires corrupted settings in database",
      "recommendation": "Replace ternary with proper try-catch wrapper using safeJsonParse"
    }
  ],
  "warnings": [
    {
      "id": "WARN-001",
      "severity": "MEDIUM",
      "category": "JSON_PARSE_DATABASE",
      "title": "Multiple Database JSON Parse Operations Without Error Handling",
      "description": "Database.js has 14 JSON.parse operations, several without proper error handling for corrupted data scenarios.",
      "affectedFiles": [
        "/home/user/pupcidslittletiktokhelper/modules/database.js"
      ],
      "recommendation": "Audit all database JSON parsing and add defensive error handling"
    },
    {
      "id": "WARN-002",
      "severity": "LOW",
      "category": "MISSING_VALIDATION",
      "title": "No JSON Schema Validation",
      "description": "Plugin manifests and configurations are not validated against schemas before parsing.",
      "recommendation": "Implement JSON schema validation for plugin.json files"
    },
    {
      "id": "WARN-003",
      "severity": "LOW",
      "category": "FILE_WRITE_NO_ATOMIC",
      "title": "Non-Atomic File Writes",
      "description": "Plugin state file writes in modules/plugin-loader.js line 310 use writeFileSync without atomic write pattern.",
      "recommendation": "Implement atomic writes (write to temp file, then rename) to prevent corruption"
    },
    {
      "id": "WARN-004",
      "severity": "LOW",
      "category": "PATH_RESOLUTION",
      "title": "Plugin Resource Path Resolution",
      "description": "Plugin resource paths use relative path construction which could fail in some deployment scenarios.",
      "recommendation": "Use path.join() and absolute paths consistently"
    },
    {
      "id": "WARN-005",
      "severity": "MEDIUM",
      "category": "DATABASE_JSON_STORAGE",
      "title": "Large JSON Objects Stored in SQLite TEXT Fields",
      "description": "Complex configurations stored as JSON strings in database could hit size limits or performance issues.",
      "recommendation": "Consider implementing JSON column type or document database for large configs"
    },
    {
      "id": "WARN-006",
      "severity": "LOW",
      "category": "LOCALE_LOADING",
      "title": "Locale Files Loaded Synchronously on Startup",
      "description": "i18n module loads all locale files synchronously in constructor, could slow startup.",
      "recommendation": "Consider lazy loading or async initialization"
    },
    {
      "id": "WARN-007",
      "severity": "LOW",
      "category": "NO_BACKUP_RECOVERY",
      "title": "No Automatic Recovery from Corrupted JSON Files",
      "description": "System has no automatic recovery mechanism when JSON files are corrupted.",
      "recommendation": "Implement automatic backup rotation and recovery system"
    }
  ],
  "recommendations": {
    "immediate": [
      {
        "priority": "CRITICAL",
        "action": "Add error handling to flow actions parsing",
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "lines": [354, 366, 377],
        "implementation": "Wrap JSON.parse() in try-catch, fallback to empty array or log error"
      },
      {
        "priority": "CRITICAL",
        "action": "Add error handling to profile config parsing",
        "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "lines": [541, 551],
        "implementation": "Wrap JSON.parse() in try-catch, fallback to default config"
      },
      {
        "priority": "HIGH",
        "action": "Replace ternary with try-catch in OBS config loading",
        "file": "/home/user/pupcidslittletiktokhelper/modules/obs-websocket.js",
        "lines": [30, 43],
        "implementation": "Use safeJsonParse utility from error-handler.js"
      }
    ],
    "shortTerm": [
      {
        "priority": "HIGH",
        "action": "Create centralized JSON parsing utility",
        "description": "Consolidate all JSON parsing through error-handler.js safeJsonParse utility",
        "benefits": ["Consistent error handling", "Easier debugging", "Better logging"]
      },
      {
        "priority": "MEDIUM",
        "action": "Implement atomic file writes for plugin state",
        "file": "/home/user/pupcidslittletiktokhelper/modules/plugin-loader.js",
        "description": "Use write-to-temp-then-rename pattern to prevent corruption during crashes"
      },
      {
        "priority": "MEDIUM",
        "action": "Add JSON validation for plugin manifests",
        "description": "Validate plugin.json structure before loading plugins",
        "libraries": ["ajv", "joi"]
      }
    ],
    "longTerm": [
      {
        "priority": "MEDIUM",
        "action": "Implement backup and recovery system",
        "description": "Automatic backups of critical JSON files with point-in-time recovery",
        "scope": ["plugins_state.json", "database backups", "user profiles"]
      },
      {
        "priority": "LOW",
        "action": "Migrate to structured storage for complex configs",
        "description": "Consider using dedicated document database or JSON column types for large configurations",
        "options": ["PostgreSQL JSONB", "MongoDB", "SQLite JSON1 extension"]
      },
      {
        "priority": "LOW",
        "action": "Add monitoring and alerting for JSON parse failures",
        "description": "Track JSON parse errors and alert on patterns indicating corruption",
        "implementation": "Integrate with error-handler.js logging"
      }
    ]
  },
  "defaultStructures": {
    "pluginState": {
      "file": "plugins/plugins_state.json",
      "structure": {
        "<plugin-id>": {
          "enabled": true,
          "loadedAt": "2025-11-14T00:00:00.000Z"
        }
      },
      "example": {
        "soundboard": {
          "enabled": true,
          "loadedAt": "2025-11-13T00:50:35.227Z"
        }
      }
    },
    "pluginManifest": {
      "file": "plugins/<plugin-id>/plugin.json",
      "requiredFields": ["id", "name", "entry"],
      "structure": {
        "id": "string (unique identifier)",
        "name": "string (display name)",
        "description": "string (optional)",
        "version": "string (semver)",
        "author": "string",
        "entry": "string (main file, e.g., main.js)",
        "enabled": "boolean (optional, default: true)",
        "type": "string (optional: module, core, utility, integration)",
        "dependencies": "array (npm packages)",
        "permissions": "array (socket.io, routes, tiktok-events, database, etc.)"
      }
    },
    "obsConfig": {
      "databaseKey": "obs_websocket_config",
      "structure": {
        "enabled": false,
        "host": "localhost",
        "port": 4455,
        "password": ""
      }
    },
    "flowDefinition": {
      "databaseTable": "flows",
      "structure": {
        "id": "integer (auto-increment)",
        "name": "string",
        "trigger_type": "string (gift, follow, subscribe, chat, etc.)",
        "trigger_condition": "JSON object or null",
        "actions": "JSON array",
        "enabled": "integer (0 or 1)"
      }
    },
    "emojiRainConfig": {
      "databaseTable": "emoji_rain_config",
      "structure": {
        "enabled": true,
        "obs_hud_enabled": true,
        "obs_hud_width": 1920,
        "obs_hud_height": 1080,
        "emoji_set": ["üíß","üíô","üíö","üíú","‚ù§Ô∏è","ü©µ","‚ú®","üåü","üî•","üéâ"],
        "physics_gravity_y": 1.0,
        "emoji_min_size_px": 40,
        "emoji_max_size_px": 80,
        "max_emojis_on_screen": 200
      }
    }
  },
  "fallbackRecoveryMechanisms": {
    "recommendedImplementation": {
      "safeJsonParse": {
        "description": "Centralized safe JSON parsing utility",
        "location": "/home/user/pupcidslittletiktokhelper/modules/error-handler.js",
        "function": "safeJsonParse(jsonString, defaultValue, logger)",
        "status": "IMPLEMENTED",
        "usage": "Replace all JSON.parse() calls with this utility"
      },
      "pluginStateRecovery": {
        "description": "Fallback to empty object if plugin state is corrupted",
        "location": "/home/user/pupcidslittletiktokhelper/modules/plugin-loader.js",
        "status": "IMPLEMENTED",
        "mechanism": "Returns {} if JSON parse fails"
      },
      "databaseBackups": {
        "description": "SQLite WAL mode provides some crash protection",
        "location": "/home/user/pupcidslittletiktokhelper/modules/database.js",
        "status": "PARTIAL",
        "currentImplementation": "WAL mode enabled",
        "recommendation": "Add periodic database backups"
      }
    },
    "needsImplementation": [
      {
        "name": "Automatic JSON file backup rotation",
        "priority": "HIGH",
        "description": "Keep last N versions of critical JSON files",
        "targetFiles": ["plugins_state.json"]
      },
      {
        "name": "Corrupted data detection and recovery",
        "priority": "MEDIUM",
        "description": "Detect corrupted JSON in database and restore from backup",
        "scope": ["flows", "profiles", "configs"]
      },
      {
        "name": "Health check endpoint for storage integrity",
        "priority": "LOW",
        "description": "API endpoint to validate all JSON storage",
        "endpoint": "/api/health/storage"
      }
    ]
  },
  "storageArchitecture": {
    "primaryStorage": {
      "type": "SQLite Database",
      "location": "user_data/database.db",
      "mode": "WAL (Write-Ahead Logging)",
      "jsonStoragePattern": "JSON strings in TEXT columns",
      "tables": {
        "settings": "Key-value pairs for global settings (includes plugin configs)",
        "flows": "Event automation flows with JSON trigger_condition and actions",
        "profiles": "User profiles with JSON config",
        "event_logs": "Event history with JSON data",
        "emoji_rain_config": "Emoji rain plugin config as JSON",
        "vdoninja_layouts": "VDO.Ninja layouts as JSON",
        "milestone_config": "Milestone celebration config",
        "plugin-specific tables": "Each plugin can create own tables"
      }
    },
    "fileBasedStorage": {
      "plugins_state.json": {
        "purpose": "Global plugin enabled/disabled state",
        "writePattern": "Synchronous write on state change",
        "atomicity": "NONE - direct writeFileSync",
        "risk": "Could corrupt on crash during write"
      },
      "locale files": {
        "pattern": "locales/*.json",
        "loading": "Synchronous on startup",
        "caching": "In-memory after load",
        "risk": "LOW - rarely changes"
      }
    },
    "dataFlow": {
      "pluginConfiguration": {
        "source": "plugins/<id>/plugin.json",
        "loaded": "On plugin initialization",
        "stored": "In memory during runtime",
        "persisted": "Database settings table for runtime config changes"
      },
      "pluginState": {
        "source": "plugins/plugins_state.json",
        "loaded": "On plugin loader initialization",
        "updated": "On enable/disable/load/unload",
        "persisted": "Immediately on state change"
      }
    }
  },
  "testCoverage": {
    "jsonValidation": {
      "allJsonFiles": "TESTED",
      "result": "All 19 JSON files are valid",
      "date": "2025-11-14"
    },
    "parsingOperations": {
      "tested": false,
      "recommendation": "Add unit tests for all JSON parsing with corrupted input"
    },
    "recoveryMechanisms": {
      "tested": false,
      "recommendation": "Add integration tests for recovery from corrupted JSON"
    }
  },
  "actionPlan": {
    "phase1_immediate": {
      "timeline": "Within 24 hours",
      "tasks": [
        {
          "task": "Add try-catch to database.js flow actions parsing",
          "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
          "lines": [353-355, 364-367, 375-378],
          "estimated_time": "30 minutes"
        },
        {
          "task": "Add try-catch to database.js profile config parsing",
          "file": "/home/user/pupcidslittletiktokhelper/modules/database.js",
          "lines": [540-542, 550-552],
          "estimated_time": "15 minutes"
        },
        {
          "task": "Replace ternary with safeJsonParse in obs-websocket.js",
          "file": "/home/user/pupcidslittletiktokhelper/modules/obs-websocket.js",
          "lines": [29-35, 42-44],
          "estimated_time": "20 minutes"
        }
      ]
    },
    "phase2_shortTerm": {
      "timeline": "Within 1 week",
      "tasks": [
        {
          "task": "Audit all remaining JSON.parse() calls without error handling",
          "scope": "All database.js parsing operations",
          "estimated_time": "2 hours"
        },
        {
          "task": "Implement atomic writes for plugin state file",
          "file": "/home/user/pupcidslittletiktokhelper/modules/plugin-loader.js",
          "estimated_time": "1 hour"
        },
        {
          "task": "Add JSON schema validation for plugin manifests",
          "estimated_time": "3 hours"
        },
        {
          "task": "Add unit tests for JSON parsing error scenarios",
          "estimated_time": "4 hours"
        }
      ]
    },
    "phase3_longTerm": {
      "timeline": "Within 1 month",
      "tasks": [
        {
          "task": "Implement automatic backup system for critical JSON files",
          "estimated_time": "8 hours"
        },
        {
          "task": "Add health check endpoint for storage integrity",
          "estimated_time": "4 hours"
        },
        {
          "task": "Implement monitoring and alerting for JSON parse failures",
          "estimated_time": "6 hours"
        },
        {
          "task": "Evaluate migration to JSONB or document database for complex configs",
          "estimated_time": "16 hours (research + implementation)"
        }
      ]
    }
  }
}
